# Умная таблетница

Этот проект предназначен для запуска на ESP32. Реализует логику "умной таблетницы": устройство фиксирует факт принятия таблетки на основании уменьшении веса на тензодатчике, включает световой сигнал и сохраняет временную отметку в память. Устройство поддерживает подключение по Bluetooth и выгрузку данных пользователя на связанное устройство. 

Сборка и прошивка (в директории проекта):

```bash
# Экспорт окружения ESP-IDF 
. $IDF_PATH/export.sh

# Установить таргет, собрать
idf.py set-target esp32
idf.py build

# Прошивка 
idf.py flash
```

Аппаратная разводка
- LED pins: `GPIO_NUM_32`, `GPIO_NUM_15`, `GPIO_NUM_16`, `GPIO_NUM_17`.
- Button pins: `GPIO_NUM_13`, `GPIO_NUM_12`, `GPIO_NUM_14`, `GPIO_NUM_27`.
- HX711 DT pins: `GPIO_NUM_5`, `GPIO_NUM_18`, `GPIO_NUM_19`, `GPIO_NUM_21`.
- HX711 SCK pins: `GPIO_NUM_4`, `GPIO_NUM_23`, `GPIO_NUM_22`, `GPIO_NUM_25`.

Схемы подключения
- LED: `GPIOx` -> резистор -> анод LED; катод -> GND.
- Кнопка: одна ножка кнопки -> `GPIOx`, другая -> GND. Модуль включает внутренний pull-up, поэтому нажатие коротит на землю (логика активна на LOW).
- HX711: подключение через преобразователь напряжения (3.3В на ESP32, 5В на HX711).

Калибровка тензодатчиков
1. Убедитесь, что платформа пустая, затем выполните тарировку (нулевание): модуль предоставляет `hx711_tare(idx, samples)`; при старте вызывается `hx711_tare`.
2. Положите эталонный груз и снимите среднее значение `raw` с `hx711_read_raw(idx)`.
3. Вычислите коэффициент: `cal_factor = (raw_mean - offset) / weight_known` и установите `hx711_set_calibration(idx, cal_factor)`.
4. Проверьте `hx711_get_weight(idx)` и при необходимости повторите.
