# ESP32 — Модульный пример: 4 LED, 4 кнопки, 4 тензодатчика (HX711)

Этот проект демонстрирует модульную структуру для простого устройства с четырьмя светодиодами, четырьмя кнопками и четырьмя тензодатчиками на базе HX711.

Сборка и прошивка (в директории проекта):

```bash
# Экспорт окружения ESP-IDF 
. $IDF_PATH/export.sh

# Установить таргет, собрать
idf.py set-target esp32
idf.py build

# Прошить и открыть монитор (замените порт на ваш)
idf.py -p /dev/tty.usbserial-XXXX flash monitor
```

Аппаратная разводка (по-умолчанию)
- LED pins (по-умолчанию): `GPIO_NUM_2`, `GPIO_NUM_15`, `GPIO_NUM_16`, `GPIO_NUM_17`.
- Button pins (по-умолчанию): `GPIO_NUM_13`, `GPIO_NUM_12`, `GPIO_NUM_14`, `GPIO_NUM_27`.
- HX711 DT pins (по-умолчанию): `GPIO_NUM_5`, `GPIO_NUM_18`, `GPIO_NUM_19`, `GPIO_NUM_21`.
- HX711 SCK pins (по-умолчанию): `GPIO_NUM_4`, `GPIO_NUM_23`, `GPIO_NUM_22`, `GPIO_NUM_25`.

Примечание: массивы пинов находятся в `main/main.c`. Подставьте в них свои пины под конкретную плату перед сборкой, если нужно.

Схемы подключения
- LED: `GPIOx` -> резистор 220..1kΩ -> анод LED; катод -> GND.
- Кнопка (рекомендуется): одна ножка кнопки -> `GPIOx`, другая -> GND. Модуль включает внутренний pull-up, поэтому нажатие коротит на землю (логика активна на LOW).
- HX711: подключите DT и SCK соответствующих каналов, обеспечьте стабильное питание для усилителя и общую землю с ESP32.

Калибровка тензодатчиков (быстрая инструкция)
1. Убедитесь, что платформа пустая, затем выполните тарировку (нулевание): модуль предоставляет `hx711_tare(idx, samples)`; в примере при старте вызывается `hx711_tare`.
2. Положите эталонный груз с известной массой (например, 100 g) и снимите среднее значение `raw` с `hx711_read_raw(idx)` (усредните 10..50 замеров).
3. Вычислите коэффициент: `cal_factor = (raw_mean - offset) / weight_known` и установите `hx711_set_calibration(idx, cal_factor)`.
4. Проверьте `hx711_get_weight(idx)` и при необходимости повторите.

Автоматическая калибровка и сохранение
- Если хотите, можно добавить процедуру автоматической калибровки и сохранение коэффициентов в NVS (не добавлено по-умолчанию). Могу добавить по запросу.

Отладка кнопок и антидребезг
- Модуль кнопок использует per-button debounce timers: ISR перезапускает таймер, и только после стабилизации уровня (по-умолчанию 50 ms) вызывается callback. Если кнопка не реагирует — проверьте проводку (должна быть к GND) и настройку пинов.
